#include "header.h"

void prisonChoix(int* choixPrison)
{
    Color(4,0);
    system("cls");
    printf("\n\n                                               ooooo ooooo oooo\n");
    Sleep(30);
    printf("                                         ooOOOOOOOOOoo000ooOOOOOOOOOooo\n");
    printf("                                      oOO000000000O0ooOOOoo0O000000000OOo \n");
    Sleep(30);
    printf("                                    oO000OOOOOOOOOOOoo0O0ooOOOOOOOOOOO000Oo\n");
    printf("                                   oOO000OOOOOOOOO0OooO0OooO0OOOOOOOOO000OOo\n");
    Sleep(30);
    printf("                                  OO00OOOOOOOOOOOO0OooO0OooO0OOOOOOOOOOOO00OO\n");
    printf("                                 OO0OOOOOOOOOOOOOO0OooO0OooO0OOOOOOOOOOOOOO0OO\n");
    Sleep(30);
    printf("                                oO0OOOOOOOOOOOOOOO0OooO0OooO0OOOOOOOOOOOOOOO0Oo\n");
    printf("                               oO0OOOOOOOOOOOOOOOO0OooO0OooO0OOOOOOOOOOOOOOOO0Oo\n");
    Sleep(30);
    printf("                               000OOOOOOOOOOOOOOOO0OooO0OoOO0OOOOOOOOOOOOOOOO000\n");
    printf("                              oO0OOOOOOOOOOOOOOOOO0OOoO0OoOO0OOOOOOOOOOOOOOOOO0Oo   \n");
    Sleep(30);
    printf("                              000OOOOOOOOOOOOOOOOO0OOoO0Oo0O0OOOOOOOOOOOOOOOOO000\n");
    printf("                             oO0OOO0000000000OOOOO0O0OO0OO0O0OOOOO0000000000OOO0Oo\n");
    Sleep(30);
    printf("                             00000OOOOOOOOOOO0000OOO00OOO00OOOO00OOOOOOOOOOOO00000\n");
    printf("                            oO0OOO0OoooooooO0OOOOOOOOOOOOOOOOOOOOO0OoooooooO0OOO0OO\n");
    Sleep(30);
    printf("                           oOOO0OooooOOOOOoooooO00OOOOOOOOOOOO0OoooooOOOOOooooO0OOOo\n");
    printf("                          OOO0oooO0OOOOOOOOOO0OOO000OOOOOOO000OOO0OOOOOOOOOO0Oooo0OOO\n");
    Sleep(30);
    printf("                        o0O0ooo0OO0OOOOOO0OOOOOOOOOOOOOOOOOOO0OOOOOOO0OOOooO0OO0ooo0OOo\n");
    printf("                       o0O0OOOOOOooooOo   ooo0OOOO000OOOOO000OOOO0ooo   oOooooOOO0OoOO0o\n");
    Sleep(30);
    printf("                      oOO0OOOO0ooO0OOO        ooOOOOOO000OOOOOOoo        OOO0Ooo0OOO00OOo \n");
    printf("                     oO00OO0OOooOOO00O           ooO00OOO00Ooo           O00OOOOoOO0OO00Oo\n");
    Sleep(30);
    printf("                    OO0OOO0OooOO00OO0O0oooo         ooooooo         oooO0O0OO00O0oOO0OO00Oo\n");
    printf("                   OO0OOO0Ooo0O0OO000ooOOOOOooooooO0O0ooo0O0OooooooOOOOOoO00OOO0O0oOO0OOO0OO\n");
    Sleep(30);
    printf("                  OO0OOO0OOo0O0OOOOOOO00OOOOOOOOOOOO0OoooO0OO0OOOoooooOO0OOOOOOO0O0oOO0OOO0OO\n");
    printf("                o0O0OOO0OOo0O0OOOOO00OO00OOOOOOO0OO0O00000O0OO0OOOOOO000OO00OOOOO0O0o0O0OOO0OO\n");
    Sleep(30);
    printf("                0O0OOO000oOO0OOOOOO000ooooOOOOOOooo00OOOOO00oooOOOOOOoooo000OOOOOO0OOo000OOO0OO\n");
    printf("               0O0OOOO0OooO0OOOOOO0OOOOOOOOOOO0ooo00O0ooO0O00ooo0OOOOOOOOOOO0OOOOOO0OooO0OOOO0OO \n");
    Sleep(30);
    printf("              OO0OOOO0OooO0O0000000oOO00000O0ooO0OOOo     oOOO0Ooo0O00000OOo000000000OooO0OOOO0OO\n");
    printf("             oO0OOOO0OOo000OOOOOOOOoo0O0O0OOoOOOOOOo   o   oOOOOOooO00O0O0oOOOOOOOOO000ooO0OOOO0Oo\n");
    Sleep(30);
    printf("             oO00OO000o0OOOO0000000OOooO000oOO0O0ooOo oOo oO o0O0OOo000OooOO00000000OOO0o000OO00Oo \n");
    printf("              oOO000Ooooooooo      ooO oOO0OOOOo  oOo o0o oOo  o0OOO0OOoo0ooo      oooooooO000OOo \n");
    Sleep(30);
    printf("               o0OOOo                o0oo0OOOOooo o0o o0o o0o oooOOOO0oo0o                oOOOOo \n");
    printf("                 ooo                  o0o ooo  Oo oOo oOo oOo oO  ooo o0o                  ooo \n");
    Sleep(30);
    printf("                                       oOooo   oo  o   o   o   o   oooOo   \n");
    printf("                                         ooo   oooo ooooooo ooooo  ooo  \n");
    Sleep(30);
    printf("                                               ooO0OOOOOOOOOO0ooo \n");
    printf("                                                 oooO0OO0Ooo \n");
    Sleep(30);
    printf("                                                      ooo \n");

    ///Affichage des différentes options
    do
    {
        gotoligcol(15,115);
        printf("QUE SOUHAITEZ VOUS FAIRE : \n");
        gotoligcol(17,115);
        printf(" 1. UTILISEZ UNE CARTE LIBERE DE PRISON\n");
        gotoligcol(18,115);
        printf(" 2. ACHETER UNE CARTE LIBERE DE PRISON A UN AUTRE JOUEUR\n");
        gotoligcol(19,115);
        printf(" 3. TENTER DE FAIRE UN DOUBLE\n");
        gotoligcol(20,115);
        printf(" 4. PAYER ET SORTIR DE PRISON\n");
        gotoligcol(21,115);
        printf(" 5. NE RIEN FAIRE\n");
        gotoligcol(22,115);
        printf(" ");
        gotoligcol(22,115);
        fflush(stdin);
        scanf("%d",choixPrison);

    }
    while(*choixPrison < 1 || *choixPrison > 5);

}

void prison (int choixPrisonPrec, joueur_t tableauDeJoueur[], int tourActuel, int nombreDeJoueur)
{

///Déclaration des variables
    int testCarteJoueur = 0;
    int pasDeCarte = 0;
    int j1,j2,j3,prixEchange,choixJoueur,variableBoucle,dee1,dee2;

    system("cls");
///Affichage
    Color(4,0);
    printf("\n\n                                               ooooo ooooo oooo\n");
    Sleep(30);
    printf("                                         ooOOOOOOOOOoo000ooOOOOOOOOOooo\n");
    printf("                                      oOO000000000O0ooOOOoo0O000000000OOo \n");
    Sleep(30);
    printf("                                    oO000OOOOOOOOOOOoo0O0ooOOOOOOOOOOO000Oo\n");
    printf("                                   oOO000OOOOOOOOO0OooO0OooO0OOOOOOOOO000OOo\n");
    Sleep(30);
    printf("                                  OO00OOOOOOOOOOOO0OooO0OooO0OOOOOOOOOOOO00OO\n");
    printf("                                 OO0OOOOOOOOOOOOOO0OooO0OooO0OOOOOOOOOOOOOO0OO\n");
    Sleep(30);
    printf("                                oO0OOOOOOOOOOOOOOO0OooO0OooO0OOOOOOOOOOOOOOO0Oo\n");
    printf("                               oO0OOOOOOOOOOOOOOOO0OooO0OooO0OOOOOOOOOOOOOOOO0Oo\n");
    Sleep(30);
    printf("                               000OOOOOOOOOOOOOOOO0OooO0OoOO0OOOOOOOOOOOOOOOO000\n");
    printf("                              oO0OOOOOOOOOOOOOOOOO0OOoO0OoOO0OOOOOOOOOOOOOOOOO0Oo  \n");
    Sleep(30);
    printf("                              000OOOOOOOOOOOOOOOOO0OOoO0Oo0O0OOOOOOOOOOOOOOOOO000\n");
    printf("                             oO0OOO0000000000OOOOO0O0OO0OO0O0OOOOO0000000000OOO0Oo\n");
    Sleep(30);
    printf("                             00000OOOOOOOOOOO0000OOO00OOO00OOOO00OOOOOOOOOOOO00000\n");
    printf("                            oO0OOO0OoooooooO0OOOOOOOOOOOOOOOOOOOOO0OoooooooO0OOO0OO\n");
    Sleep(30);
    printf("                           oOOO0OooooOOOOOoooooO00OOOOOOOOOOOO0OoooooOOOOOooooO0OOOo\n");
    printf("                          OOO0oooO0OOOOOOOOOO0OOO000OOOOOOO000OOO0OOOOOOOOOO0Oooo0OOO\n");
    Sleep(30);
    printf("                        o0O0ooo0OO0OOOOOO0OOOOOOOOOOOOOOOOOOO0OOOOOOO0OOOooO0OO0ooo0OOo\n");
    printf("                       o0O0OOOOOOooooOo   ooo0OOOO000OOOOO000OOOO0ooo   oOooooOOO0OoOO0o\n");
    Sleep(30);
    printf("                      oOO0OOOO0ooO0OOO        ooOOOOOO000OOOOOOoo        OOO0Ooo0OOO00OOo \n");
    printf("                     oO00OO0OOooOOO00O           ooO00OOO00Ooo           O00OOOOoOO0OO00Oo\n");
    Sleep(30);
    printf("                    OO0OOO0OooOO00OO0O0oooo         ooooooo         oooO0O0OO00O0oOO0OO00Oo\n");
    printf("                   OO0OOO0Ooo0O0OO000ooOOOOOooooooO0O0ooo0O0OooooooOOOOOoO00OOO0O0oOO0OOO0OO\n");
    Sleep(30);
    printf("                  OO0OOO0OOo0O0OOOOOOO00OOOOOOOOOOOO0OoooO0OO0OOOoooooOO0OOOOOOO0O0oOO0OOO0OO\n");
    printf("                o0O0OOO0OOo0O0OOOOO00OO00OOOOOOO0OO0O00000O0OO0OOOOOO000OO00OOOOO0O0o0O0OOO0OO\n");
    Sleep(30);
    printf("                0O0OOO000oOO0OOOOOO000ooooOOOOOOooo00OOOOO00oooOOOOOOoooo000OOOOOO0OOo000OOO0OO\n");
    printf("               0O0OOOO0OooO0OOOOOO0OOOOOOOOOOO0ooo00O0ooO0O00ooo0OOOOOOOOOOO0OOOOOO0OooO0OOOO0OO \n");
    Sleep(30);
    printf("              OO0OOOO0OooO0O0000000oOO00000O0ooO0OOOo     oOOO0Ooo0O00000OOo000000000OooO0OOOO0OO\n");
    printf("             oO0OOOO0OOo000OOOOOOOOoo0O0O0OOoOOOOOOo   o   oOOOOOooO00O0O0oOOOOOOOOO000ooO0OOOO0Oo\n");
    Sleep(30);
    printf("             oO00OO000o0OOOO0000000OOooO000oOO0O0ooOo oOo oO o0O0OOo000OooOO00000000OOO0o000OO00Oo \n");
    printf("              oOO000Ooooooooo      ooO oOO0OOOOo  oOo o0o oOo  o0OOO0OOoo0ooo      oooooooO000OOo \n");
    Sleep(30);
    printf("               o0OOOo                o0oo0OOOOooo o0o o0o o0o oooOOOO0oo0o                oOOOOo \n");
    printf("                 ooo                  o0o ooo  Oo oOo oOo oOo oO  ooo o0o                  ooo \n");
    Sleep(30);
    printf("                                       oOooo   oo  o   o   o   o   oooOo   \n");
    printf("                                         ooo   oooo ooooooo ooooo  ooo  \n");
    Sleep(30);
    printf("                                               ooO0OOOOOOOOOO0ooo \n");
    printf("                                                 oooO0OO0Ooo \n");
    Sleep(30);
    printf("                                                      ooo \n");

///En fonction des cas
    switch(choixPrisonPrec)
    {
    case 1 :
    {
        if(tableauDeJoueur[tourActuel].libertePrison == 0)
        {
            gotoligcol(15,115);
            printf("Vous n'avez pas de carte libere de prison !");
            Sleep(2000);
            prisonChoix(&choixPrisonPrec);
            prison(choixPrisonPrec,tableauDeJoueur,tourActuel,nombreDeJoueur);
        }
        else
        {
            tableauDeJoueur[tourActuel].libertePrison --;
            tableauDeJoueur[tourActuel].tourPrison == 0;
            gotoligcol(15,115);
            printf("Votre nombre de carte s'eleve maintenant a : %d",tableauDeJoueur[tourActuel].libertePrison);
        }
        break;
    }
    case 2 :
    {
        ///On vérifie si des joueurs ont des cartes libérer de prison
        for(int i=0; i<nombreDeJoueur ; i++)
        {
            if(tableauDeJoueur[i].libertePrison != 0 && i != tourActuel)
            {
                testCarteJoueur = testCarteJoueur + 1;
            }
        }

        ///Si aucun joueur n'a ce type de carte:
        if(testCarteJoueur == 0)
        {
            gotoligcol(15,115);
            printf("Aucun autre joueur n'a cette carte");
            Sleep(2000);
            prisonChoix(&choixPrisonPrec);
            prison(choixPrisonPrec,tableauDeJoueur,tourActuel,nombreDeJoueur);
        }
        ///Si un joueur a ce type de carte :
        else
        {
            for(int j=0 ; j<nombreDeJoueur ; j++)
            {
                variableBoucle = 0;
                if(tableauDeJoueur[j].libertePrison != 0 && j != tourActuel)
                {
                    gotoligcol(15,115);
                    printf("%d. Demander une carte a %s \n",j+1,tableauDeJoueur[j].nomJoueur);
                    if(variableBoucle == 0)
                    {
                        j1 = j;
                    }
                    if(variableBoucle == 1)
                    {
                        j2 = j;
                    }
                    if(variableBoucle == 2)
                    {
                        j3 = j;
                    }
                    variableBoucle = variableBoucle + 1;
                }
            }


            do
            {
                gotoligcol(16,115);
                printf("%s etes vous d'accord ? : ||OUI : 1||NON : 0|| : ",tableauDeJoueur[j1].nomJoueur);
                fflush(stdin);
                scanf("%d",&choixJoueur);
            }
            while(choixJoueur != 0 && choixJoueur != 1);

            if(choixJoueur == 1)
                do
                {
                    gotoligcol(17,115);
                    printf("A quelle somme voulez vous l'echanger ? : ");
                    fflush(stdin);
                    scanf("%d",&prixEchange);
                }
                while(prixEchange <0);

            do
            {
                gotoligcol(18,115);
                printf("%s etes vous d'accord ? : ||OUI : 1||NON : 0|| : ",tableauDeJoueur[tourActuel].nomJoueur);
                fflush(stdin);
                scanf("%d",&choixJoueur);
            }
            while(choixJoueur != 0 && choixJoueur != 1);
            if(choixJoueur == 1)
            {
                tableauDeJoueur[tourActuel].argent = tableauDeJoueur[tourActuel].argent - prixEchange;
                tableauDeJoueur[j1].argent = tableauDeJoueur[j1].argent + prixEchange;
                tableauDeJoueur[j1].libertePrison = tableauDeJoueur[j1].libertePrison - 1;
                tableauDeJoueur[tourActuel].tourPrison = 0;
                gotoligcol(19,115);
                printf("Vous sortez de prison.");
            }
            if(testCarteJoueur > 1 && choixJoueur == 0)
            {
                do
                {
                    gotoligcol(19,115);
                    printf("%s etes vous d'accord ? : ||OUI : 1||NON : 0|| : ",tableauDeJoueur[j2].nomJoueur);
                    fflush(stdin);
                    scanf("%d",&choixJoueur);
                }
                while(choixJoueur != 0 && choixJoueur != 1);

                if(choixJoueur == 1)
                    do
                    {
                        gotoligcol(20,115);
                        printf("A quelle somme voulez vous l'echanger ? : ");
                        fflush(stdin);
                        scanf("%d",&prixEchange);
                    }
                    while(prixEchange <0);

                do
                {
                    gotoligcol(21,115);
                    printf("%s etes vous d'accord ? : ||OUI : 1||NON : 0|| : ",tableauDeJoueur[tourActuel].nomJoueur);
                    fflush(stdin);
                    scanf("%d",&choixJoueur);
                }
                while(choixJoueur != 0 && choixJoueur != 1);
                if(choixJoueur == 1)
                {
                    tableauDeJoueur[tourActuel].argent = tableauDeJoueur[tourActuel].argent - prixEchange;
                    tableauDeJoueur[j2].argent = tableauDeJoueur[j2].argent + prixEchange;
                    tableauDeJoueur[j2].libertePrison = tableauDeJoueur[j2].libertePrison - 1;
                    tableauDeJoueur[tourActuel].tourPrison = 0;
                    gotoligcol(22,115);
                    printf("Vous sortez de prison.");
                }
                if(testCarteJoueur > 2 && choixJoueur == 0)
                {
                    do
                    {
                        gotoligcol(22,115);
                        printf("%s etes vous d'accord ? : ||OUI : 1||NON : 0|| : ",tableauDeJoueur[j3].nomJoueur);
                        fflush(stdin);
                        scanf("%d",&choixJoueur);
                    }
                    while(choixJoueur != 0 && choixJoueur != 1);

                    if(choixJoueur == 1)
                        do
                        {
                            gotoligcol(23,115);
                            printf("A quelle somme voulez vous l'echanger ? : ");
                            fflush(stdin);
                            scanf("%d",&prixEchange);
                        }
                        while(prixEchange <0);

                    do
                    {
                        gotoligcol(24,115);
                        printf("%s etes vous d'accord ? : ||OUI : 1||NON : 0|| : ",tableauDeJoueur[tourActuel].nomJoueur);
                        fflush(stdin);
                        scanf("%d",&choixJoueur);
                    }
                    while(choixJoueur != 0 && choixJoueur != 1);
                    if(choixJoueur == 1)
                    {
                        tableauDeJoueur[tourActuel].argent = tableauDeJoueur[tourActuel].argent - prixEchange;
                        tableauDeJoueur[j3].argent = tableauDeJoueur[j3].argent + prixEchange;
                        tableauDeJoueur[j3].libertePrison = tableauDeJoueur[j3].libertePrison - 1;
                        tableauDeJoueur[tourActuel].tourPrison = 0;
                        gotoligcol(25,115);
                        printf("Vous sortez de prison.");
                    }
                }
            }
            if(choixJoueur == 0)
            {
                prisonChoix(&choixPrisonPrec);
                prison(choixPrisonPrec,tableauDeJoueur,tourActuel,nombreDeJoueur);
            }
        }
        break;
    }
    case 3:
    {
        lancerDeDes(&dee1,&dee2);
        afficherDe(dee1,dee2);

        if(dee1 == dee2)
        {
            gotoligcol(15,115);
            printf("Vous avez fait un double, vous sortez de prison");
            tableauDeJoueur[tourActuel].tourPrison = 0;
            tableauDeJoueur[tourActuel].position += (dee1 + dee2);
            Sleep(1500);
        }
        else
        {
            gotoligcol(15,115);
            printf("Echec !");
            Sleep(1500);
            tableauDeJoueur[tourActuel].tourPrison ++;
            if(tableauDeJoueur[tourActuel].tourPrison == 4)
            {
                gotoligcol(16,115);
                printf("Vous sortez de prison en payant 50 credit !");
                tableauDeJoueur[tourActuel].argent -= 50;
                tableauDeJoueur[tourActuel].tourPrison = 0;
                sleep(1500);
            }

        }
        break;
    }
    case 4:
    {
        if(tableauDeJoueur[tourActuel].argent < 50)
        {
            gotoligcol(15,115);
            printf("Vous n'avez pas assez d'argent !");
            Sleep(2000);
            prisonChoix(&choixPrisonPrec);
            prison(choixPrisonPrec,tableauDeJoueur,tourActuel,nombreDeJoueur);
        }
        else
        {
            gotoligcol(15,115);
            printf("Vous avez decider de payer 50 credits,");
            gotoligcol(16,115);
            printf("vous sortez de prison !");
            Sleep(1500);
            tableauDeJoueur[tourActuel].argent -= 50;
            tableauDeJoueur[tourActuel].tourPrison = 0;
        }
        break;
    }
    case 5 :
    {
        gotoligcol(15,115);
        printf("Vous avez decide d'attendre");
        tableauDeJoueur[tourActuel].tourPrison ++;
        Sleep(2000);
        break;
    }

    }

    system("cls");
}
